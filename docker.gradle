task stopContainer(type: Exec, group: 'docker') {
    doFirst { executable "sh"
        args "-c", "docker stop maintenance || true"
    }
}

task deleteContainer(type: Exec, group: 'docker') {
    doFirst { executable "sh"
        args "-c", 'docker rm maintenance || true'
    }
}

task deleteImage(type: Exec, group: 'docker') {
    doFirst { executable "sh"
        args "-c", 'docker rmi terahorse/maintenance || true'
    }
}

task createImage(type: Exec, group: 'docker') {
    doFirst { executable "sh"
        args "-c", 'docker build -t terahorse/maintenance .'
    }
}

task runContainer(type: Exec, group: 'docker') {
    doFirst { executable "sh"
        args "-c", 'docker run -d -p 5000:5000 --name maintenance terahorse/maintenance'
    }
}

task publishImage(type: Exec, group: 'docker') {
    doFirst { executable "sh"
        args "-c", 'docker push terahorse/maintenance'
    }
}

publishImage { dependsOn createImage }
runContainer { dependsOn createImage }
createImage { dependsOn deleteImage }
deleteImage { dependsOn deleteContainer }
deleteContainer { dependsOn stopContainer }
stopContainer { dependsOn bootJar }


